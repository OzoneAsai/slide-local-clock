<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Lock Screen UI with Custom Config, Font, Text Size & Time Format</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kaisei+Decol&family=M+PLUS+Rounded+1c&family=Noto+Sans+JP:wght@100..900&family=Noto+Serif+JP:wght@200..900&family=Zen+Kaku+Gothic+New&family=Zen+Maru+Gothic&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      overflow: hidden;
      font-family: "Noto Sans JP", sans-serif;
      color: white;
      background: black;
    }
    .noto-sans-jp-default {
      font-family: "Noto Sans JP", sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
    }
    .noto-serif-jp-default {
      font-family: "Noto Serif JP", serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
    }
    .zen-kaku-gothic-new-regular {
      font-family: "Zen Kaku Gothic New", sans-serif;
      font-weight: 400;
      font-style: normal;
    }
    .m-plus-rounded-1c-regular {
      font-family: "M PLUS Rounded 1c", sans-serif;
      font-weight: 400;
      font-style: normal;
    }
    .zen-maru-gothic-regular {
      font-family: "Zen Maru Gothic", serif;
      font-weight: 400;
      font-style: normal;
    }
    .kaisei-decol-regular {
      font-family: "Kaisei Decol", serif;
      font-weight: 400;
      font-style: normal;
    }
    #bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-size: cover;
      background-position: center;
      transition: background-image 1s ease-in-out;
    }
    .blur {
      filter: blur(8px);
    }
    #clock {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 2;
      text-shadow: 0 0 20px rgba(0,0,0,0.8);
    }
    #clock h1 {
      font-size: 80px;
      margin: 0;
    }
    #clock p {
      font-size: 40px;
      margin: 0;
    }
    #settingsToggle {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 3;
      background: rgba(0, 0, 0, 0.6);
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 16px;
    }

    #settingsOverlay,
    #imageConfigOverlay {
      display: none;
    }
    #settingsOverlay {
      position: absolute;
      top: 48px;
      right: 20px;
      width: 320px;
      background: rgba(32, 32, 32, 0.9);
      color: white;
      z-index: 4;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.7);
      max-height: 80%;
      overflow-y: auto;
    }
    #imageConfigOverlay {
      position: fixed;
      top: 0;
      right: 0;
      width: 320px;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      z-index: 4;
      overflow-y: auto;
      padding: 10px;
    }
    #settingsOverlay.open { display: block; }
    #settingsOverlayHeader,
    #imageConfigOverlayHeader {
      font-size: 20px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #imageConfigOverlayClose {
      cursor: pointer;
    }
    .sectionTitle {
      margin-top: 15px;
      font-weight: bold;
    }
    #imageConfigOverlayContent .imageConfig {
      border-bottom: 1px solid rgba(255,255,255,0.2);
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    #imageConfigOverlayContent .imageConfig.active {
      background: rgba(255,255,255,0.1);
    }
    .imageConfig {
      margin-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      padding-bottom: 10px;
    }
    .imageConfig:last-child {
      border-bottom: none;
    }
    .imageConfig label {
      display: block;
      font-size: 14px;
      margin-top: 5px;
    }
    .imageConfig input[type="number"] {
      width: 60px;
    }
    .fontConfig, .textSizeConfig, .timeFormatConfig {
      margin-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.2);
      padding-top: 10px;
    }
    .fontConfig label, .textSizeConfig label, .timeFormatConfig label {
      font-size: 14px;
    }
    .fontConfig select, .textSizeConfig input {
      width: 100%;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="bg"></div>
  <div id="clock" class="noto-sans-jp-default">
    <h1 id="time">--:--:--</h1>
    <p id="date">----/--/--</p>
  </div>
  <button id="settingsToggle">⚙️</button>

  <div id="settingsOverlay">
    <div id="settingsOverlayHeader">Settings</div>
    <div id="settingsOverlayContent">
      <div class="sectionTitle">Font</div>
      <label for="fontSelect">フォント選択:</label>
      <select id="fontSelect">
        <option value="noto-sans-jp-default">Noto Sans JP</option>
        <option value="noto-serif-jp-default">Noto Serif JP</option>
        <option value="zen-kaku-gothic-new-regular">Zen Kaku Gothic New</option>
        <option value="m-plus-rounded-1c-regular">M PLUS Rounded 1c</option>
        <option value="zen-maru-gothic-regular">Zen Maru Gothic</option>
        <option value="kaisei-decol-regular">Kaisei Decol</option>
      </select>

      <div class="sectionTitle">Text Size</div>
      <label for="charSizeMultiplier">文字サイズ倍率 (例: 1.0):</label>
      <input type="number" id="charSizeMultiplier" step="0.1" min="0.1" value="1.0">

      <div class="sectionTitle">Time Format</div>
      <label for="displaySeconds">秒まで表示する:</label>
      <input type="checkbox" id="displaySeconds" checked>

      <div class="sectionTitle">Controls</div>
      <div class="controlButtons">
        <button id="prevBtn">Prev</button>
        <button id="fullscreenBtn">Full</button>
        <button id="nextBtn">Next</button>
      </div>

      <div class="sectionTitle">Background Images</div>
      <button id="openImageConfigBtn">画像設定</button>
      <button id="openFolderBtn">フォルダーを開く</button>
    </div>
  </div>

  <div id="imageConfigOverlay">
    <div id="imageConfigOverlayHeader">
      Image Settings <span id="imageConfigOverlayClose">✖</span>
    </div>
    <div id="imageConfigOverlayContent"></div>
  </div>
  <script>
    function updateClock() {
      const now = new Date();
      const displaySeconds = document.getElementById('displaySeconds').checked;
      if (displaySeconds) {
        document.getElementById('time').textContent = now.toLocaleTimeString();
      } else {
        document.getElementById('time').textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }
      document.getElementById('date').textContent = now.toLocaleDateString();
    }
    setInterval(updateClock, 1000);
    updateClock();

    function updateTextSize(multiplier) {
      const timeElem = document.getElementById('time');
      const dateElem = document.getElementById('date');
      timeElem.style.fontSize = (80 * multiplier) + 'px';
      dateElem.style.fontSize = (40 * multiplier) + 'px';
    }
    updateTextSize(parseFloat(document.getElementById('charSizeMultiplier').value));
    document.getElementById('charSizeMultiplier').addEventListener('change', e => {
      updateTextSize(parseFloat(e.target.value));
    });

    let backgrounds = [];
    let currentBg = 0;
    let slideTimeoutId = null;
    const defaultInterval = 500000;
    let bgConfigs = [];
    const bgDiv = document.getElementById('bg');

    const settingsToggle = document.getElementById('settingsToggle');
    const settingsOverlay = document.getElementById('settingsOverlay');
    settingsToggle.addEventListener('click', () => {
      settingsOverlay.classList.toggle('open');
    });

    document.getElementById('openFolderBtn').addEventListener('click', () => {
      if (window.electronAPI && window.electronAPI.openImagesFolder) {
        window.electronAPI.openImagesFolder();
      } else {
        alert('Opening the folder requires the Electron build.');
      }
    });

    const imageConfigOverlay = document.getElementById('imageConfigOverlay');
    const imageConfigOverlayClose = document.getElementById('imageConfigOverlayClose');
    document.getElementById('openImageConfigBtn').addEventListener('click', () => {
      buildImageConfigOverlay();
      imageConfigOverlay.style.display = 'block';
    });
    imageConfigOverlayClose.addEventListener('click', () => {
      imageConfigOverlay.style.display = 'none';
    });

    document.getElementById('prevBtn').addEventListener('click', prevBackground);
    document.getElementById('nextBtn').addEventListener('click', nextBackground);
    document.getElementById('fullscreenBtn').addEventListener('click', () => {
      document.documentElement.requestFullscreen();
    });

    const fontSelect = document.getElementById('fontSelect');
    fontSelect.addEventListener('change', function() {
      const clockElem = document.getElementById('clock');
      clockElem.className = '';
      clockElem.classList.add(this.value);
    });

    fetch('/backgrounds')
      .then(r => r.json())
      .then(data => {
        backgrounds = data;
        bgConfigs = backgrounds.map(() => ({ interval: defaultInterval, blur: false, gradientBlur: true }));
        if (backgrounds.length) {
          setBackground(backgrounds[currentBg]);
          scheduleNextSlide();
        }
      });

    function buildImageConfigOverlay() {
      const container = document.getElementById('imageConfigOverlayContent');
      container.innerHTML = '';
      backgrounds.forEach((imgUrl, i) => {
        const block = document.createElement('div');
        block.className = 'imageConfig';
        if (i === currentBg) block.classList.add('active');
        block.innerHTML = `
          <strong>Image ${i + 1}</strong>
          <label>スライド間隔 (秒):
            <input type="number" min="1" value="${bgConfigs[i].interval / 1000}" data-idx="${i}" class="intervalInput">
          </label>
          <label>ブラー適用:
            <input type="checkbox" data-idx="${i}" class="blurToggle" ${bgConfigs[i].blur ? 'checked' : ''}>
          </label>
          <label>Gradientブラー (文字周辺):
            <input type="checkbox" data-idx="${i}" class="gradientBlurToggle" ${bgConfigs[i].gradientBlur ? 'checked' : ''}>
          </label>
          <div style="margin-top: 8px;">
            <button class="previewBtn" data-idx="${i}">プレビュー</button>
          </div>
        `;
        container.appendChild(block);
      });

      container.querySelectorAll('.intervalInput').forEach(el => {
        el.addEventListener('change', e => {
          const idx = parseInt(e.target.dataset.idx);
          bgConfigs[idx].interval = parseInt(e.target.value) * 1000;
          if (idx === currentBg) rescheduleSlide();
        });
      });
      container.querySelectorAll('.blurToggle').forEach(el => {
        el.addEventListener('change', e => {
          const idx = parseInt(e.target.dataset.idx);
          bgConfigs[idx].blur = e.target.checked;
          if (idx === currentBg) setBackground(backgrounds[currentBg]);
        });
      });
      container.querySelectorAll('.gradientBlurToggle').forEach(el => {
        el.addEventListener('change', e => {
          const idx = parseInt(e.target.dataset.idx);
          bgConfigs[idx].gradientBlur = e.target.checked;
          if (idx === currentBg) {
            const clockElem = document.getElementById('clock');
            clockElem.style.textShadow = bgConfigs[idx].gradientBlur ? '0 0 20px rgba(0,0,0,0.8)' : 'none';
          }
        });
      });
      container.querySelectorAll('.previewBtn').forEach(el => {
        el.addEventListener('click', e => {
          const idx = parseInt(e.target.dataset.idx);
          openImagePreview(idx);
        });
      });
    }

    function openImagePreview(idx) {
      currentBg = idx;
      setBackground(backgrounds[currentBg]);
      rescheduleSlide();
      buildImageConfigOverlay();
    }

    function setBackground(imgPath) {
      bgDiv.style.backgroundImage = `url('/static/${imgPath}')`;
      const config = bgConfigs[currentBg];
      if (config.blur) {
        bgDiv.classList.add('blur');
      } else {
        bgDiv.classList.remove('blur');
      }
      const clockElem = document.getElementById('clock');
      clockElem.style.textShadow = config.gradientBlur ? '0 0 20px rgba(0,0,0,0.8)' : 'none';
    }

    function scheduleNextSlide() {
      if (slideTimeoutId) clearTimeout(slideTimeoutId);
      const config = bgConfigs[currentBg];
      slideTimeoutId = setTimeout(nextBackground, config.interval);
    }

    function rescheduleSlide() {
      scheduleNextSlide();
    }

    function nextBackground() {
      if (!backgrounds.length) return;
      currentBg = (currentBg + 1) % backgrounds.length;
      setBackground(backgrounds[currentBg]);
      scheduleNextSlide();
    }

    function prevBackground() {
      if (!backgrounds.length) return;
      currentBg = (currentBg - 1 + backgrounds.length) % backgrounds.length;
      setBackground(backgrounds[currentBg]);
      scheduleNextSlide();
    }
  </script>
</body>
</html>
